---
const sessionId = Astro.url.searchParams.get('session_id');

let data = null;
let error = null;

if (sessionId) {
  try {
    const response = await fetch(`http://127.0.0.1:8000/storage?session_id=${sessionId}`);
    const result = await response.json();

    if (result.status === 'ok') {
      data = result.result;
    } else {
      error = result.reason;
    }
  } catch (e) {
    error = e.message;
  }
} else {
  error = 'No session_id provided';
}
---

<div class="box">
  {error ? <p class="error">Error: {error}</p> : data ? <pre>{JSON.stringify(data, null, 2)}</pre> : <p>Loading...</p>}
</div>

<style>
  .box {
    max-width: 800px;
    margin: 2rem auto;
    padding: 2rem;
    border: 1px solid #ccc;
    border-radius: 8px;
    background: white;
  }

  pre {
    background: #f5f5f5;
    padding: 1rem;
    border-radius: 4px;
    overflow-x: auto;
  }

  .error {
    color: red;
  }
</style>
